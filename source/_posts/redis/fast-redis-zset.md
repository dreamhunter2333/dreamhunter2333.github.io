---
title: fast redis zset
date: 2020-11-25 21:40:37
categories: redis
tags: redis
---

## fast redis zset

redis支持一个数据结构，叫做 zset，也就是有序的列表。

通过它，可以实现游戏排行榜一类的功能，或者实现Topx这样的需求，也能精准的让用户在海量数据中找到自己的位置。

zset的底层结构是跳跃表，而与之类似的Java中的有序Set是TreeSet，使用红黑树实现的。

我们的问题是：zset中能存放多少条记录？线上有没有有说服力的数据？

先笼统的回答一下，zset理论上支持的元素最多是2^32-1个，约42亿，如果你的内存够大，放下国人绰绰有余。

在测试的zset里，存放了接近6千万的数据，我们就要算在这6千万内任何的排行。zcard、zrank等一系列操作，easy实现。

运行一段时间后，内存直接飙升到了8G左右。这是由于跳表的特殊结构所引起的，额外的辅助信息会占用更多的内存。

以下是经验值：

最高TPS写入量1k/秒。
同时最高QPS查询量5k/秒。
平均耗时5ms左右。
百分之95的请求都在10ms以内返回。
长尾请求超过100ms的不超过100条。
也就是说，在保持高写入和高查询的同时，zset能够保证较低的响应耗时。

[参考链接](https://zhuanlan.zhihu.com/p/153047528?utm_source=wechat_session)
