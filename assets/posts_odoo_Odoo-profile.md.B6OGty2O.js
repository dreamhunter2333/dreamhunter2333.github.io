import{_ as s,c as i,o as a,aj as n}from"./chunks/framework.Cy5U5pv3.js";const y=JSON.parse('{"title":"Odoo @profile 性能测试","description":"","frontmatter":{"title":"Odoo @profile 性能测试","date":"2019-10-30 22:47:16","categories":"odoo","tags":["odoo"]},"headers":[],"relativePath":"posts/odoo/Odoo-profile.md","filePath":"posts/odoo/Odoo-profile.md","lastUpdated":1720265245000}'),h={name:"posts/odoo/Odoo-profile.md"},l=n(`<h1 id="odoo-profile-性能测试" tabindex="-1">Odoo @profile 性能测试 <a class="header-anchor" href="#odoo-profile-性能测试" aria-label="Permalink to &quot;Odoo @profile 性能测试&quot;">​</a></h1><h2 id="odoo-profile-性能测试-1" tabindex="-1">Odoo @profile 性能测试 <a class="header-anchor" href="#odoo-profile-性能测试-1" aria-label="Permalink to &quot;Odoo @profile 性能测试&quot;">​</a></h2><h3 id="odoo-rst-文档" tabindex="-1">odoo rst 文档 <a class="header-anchor" href="#odoo-rst-文档" aria-label="Permalink to &quot;odoo rst 文档&quot;">​</a></h3><p>Another profiler can be used to log statistics on a method:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> odoo.tools.profiler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> profile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @profile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @api.model</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mymethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(...):</span></span></code></pre></div><p>The statistics will be displayed into the logs once the method to be analysed is completely reviewed.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    2018-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 06:18:23,196</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22878</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openerp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> odoo.tools.profiler:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    calls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     queries</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    project.task</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ------------------------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/odoo/src/odoo/addons/project/models/project.py,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 638</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          @profile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                      @api.model</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                      def</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">self,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                          # context: no_log, because subtype already handle this</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">self.env.context,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mail_create_nolog=True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                          # for default stage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vals.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;project_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> context.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;default_project_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                              context[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;default_project_id&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vals.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;project_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                          # user_id change: update date_assign</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vals.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;user_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                              vals[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;date_assign&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fields.Datetime.now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                          # Stage change: Update date_end if folded stage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vals.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;stage_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                              vals.update(self.update_date_end(vals[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;stage_id&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         108</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       631.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             task</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Task,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> self.with_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> task</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Total:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         108</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       631.85</span></span></code></pre></div><h3 id="profile-用法" tabindex="-1">@profile 用法 <a class="header-anchor" href="#profile-用法" aria-label="Permalink to &quot;@profile 用法&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 引入 profile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> odoo.tools.profiler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> profile</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 添加装饰器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @api.model_create_multi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @profile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vals_list):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        ...</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 输出结果</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2019-10-30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 14:41:29,185</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6884</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1029</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> odoo.tools.profiler:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">calls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     queries</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">res.users</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---------------------------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/odoo/./core/odoo/addons/base/models/res_users.py,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 474</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          @api.model_create_multi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                  @profile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                  def</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">self,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vals_list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         56</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        313.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             users</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Users,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vals_list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.04</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         9.17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  user.partner_id.write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({&#39;company_id&#39;: user.company_id.id, &#39;active&#39;: user.active})</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Total:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         58</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        322.84</span></span></code></pre></div>`,10),k=[l];function p(t,e,F,d,r,o){return a(),i("div",null,k)}const E=s(h,[["render",p]]);export{y as __pageData,E as default};
