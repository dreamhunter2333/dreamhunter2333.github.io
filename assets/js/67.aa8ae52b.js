(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{560:function(t,s,a){"use strict";a.r(s);var e=a(6),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"odoo-profile-性能测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#odoo-profile-性能测试"}},[t._v("#")]),t._v(" Odoo @profile 性能测试")]),t._v(" "),a("h3",{attrs:{id:"odoo-rst-文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#odoo-rst-文档"}},[t._v("#")]),t._v(" odoo rst 文档")]),t._v(" "),a("p",[t._v("Another profiler can be used to log statistics on a method:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" odoo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("profiler "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" profile\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@profile")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mymethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),a("p",[t._v("The statistics will be displayed into the logs once the method to be analysed is\ncompletely reviewed.")]),t._v(" "),a("div",{staticClass:"language-log extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("    2018-03-28 06:18:23,196 22878 INFO openerp odoo.tools.profiler:\n    calls     queries   ms\n    project.task ------------------------ /home/odoo/src/odoo/addons/project/models/project.py, 638\n\n    1         0         0.02          @profile\n                                      @api.model\n                                      def create(self, vals):\n                                          # context: no_log, because subtype already handle this\n    1         0         0.01              context = dict(self.env.context, mail_create_nolog=True)\n\n                                          # for default stage\n    1         0         0.01              if vals.get('project_id') and not context.get('default_project_id'):\n                                              context['default_project_id'] = vals.get('project_id')\n                                          # user_id change: update date_assign\n    1         0         0.01              if vals.get('user_id'):\n                                              vals['date_assign'] = fields.Datetime.now()\n                                          # Stage change: Update date_end if folded stage\n    1         0         0.0               if vals.get('stage_id'):\n                                              vals.update(self.update_date_end(vals['stage_id']))\n    1         108       631.8             task = super(Task, self.with_context(context)).create(vals)\n    1         0         0.01              return task\n\n    Total:\n    1         108       631.85\n")])])]),a("h3",{attrs:{id:"profile-用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#profile-用法"}},[t._v("#")]),t._v(" @profile 用法")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引入 profile")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" odoo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("profiler "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" profile\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加装饰器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model_create_multi")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@profile")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vals_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("div",{staticClass:"language-log extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\x3c!-- 输出结果 --\x3e\n2019-10-30 14:41:29,185 6884 INFO 1029 odoo.tools.profiler:\ncalls     queries   ms\nres.users --------------------------- /opt/odoo/./core/odoo/addons/base/models/res_users.py, 474\n\n1         0         0.02          @api.model_create_multi\n                                  @profile\n                                  def create(self, vals_list):\n1         56        313.6             users = super(Users, self).create(vals_list)\n3         0         0.04              for user in users:\n1         2         9.17                  user.partner_id.write({'company_id': user.company_id.id, 'active': user.active})\n1         0         0.0               return users\n\nTotal:\n1         58        322.84\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);